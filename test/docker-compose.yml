version: "3.4"

services:
  minecraft:
      image: itzg/minecraft-server
      ports:
        - 25565:25565
      container_name: minecraft_server
      environment:
        EULA: "TRUE"
        TYPE: "PAPER"
        OPS: "LuisGamer02031"
        ENABLE_WHITELIST: "TRUE"
        ENFORCE_WHITELIST: "TRUE"
        OVERRIDE_SERVER_PROPERTIES: "TRUE"
        SERVER_NAME: "MOCHI SERVER"
        MEMORY: "4G"
        MODE: "SURVIVAL"
        ONLINE_MODE: "TRUE"
        ANNOUNCE_PLAYER_ACHIEVEMENTS: "TRUE"
        ALLOW_NETHER: "TRUE"
        OVERRIDE_ICON: "TRUE"
        ICON: "https://cdn.vox-cdn.com/thumbor/8KxJUDwQsz5Qy-_HzZjtCTRR5PU=/0x164:1440x884/fit-in/1200x600/cdn.vox-cdn.com/uploads/chorus_asset/file/22310830/NmJgg.jpg"
        MOTD: "Welcome to the server!"
      volumes:
        - mc:/data
      tty: true
      stdin_open: true
      restart: unless-stopped
  backups:
    image: itzg/mc-backup
    environment:
      BACKUP_INTERVAL: "2h"
      RCON_HOST: mc
      PRE_BACKUP_SCRIPT: |
        echo "Before backup!"
        echo "Also before backup from $$RCON_HOST to $$DEST_DIR"
      POST_BACKUP_SCRIPT_FILE: /post-backup.sh
    volumes:
      # mount the same volume used by server, but read-only
      - mc:/data:ro
      # use a host attached directory so that it in turn can be backed up
      # to external/cloud storage
      - ./mc-backups:/backups
      - ./post-backup.sh:/post-backup.sh:ro
volumes:
  mc: {}
